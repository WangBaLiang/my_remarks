---
layout: post
title: Mongo
categories: [数据库]
tags: [Mongo]
disqus: y
---
#Mongo
##安装与使用
1. [下载mongo](https://www.mongodb.com/download-center#community)      
解压至/usr/local/mongo    
ln -s /usr/local/mongo/bin/mongod /usr/local/bin/mongo      

2. 组成

        bin/mongod            - The database process.
        bin/mongos            - Sharding controller.
        bin/mongo             - The database shell (uses interactive javascript).
        bin/mongodump         - MongoDB dump tool - for backups, snapshots, etc..
        bin/mongorestore      - MongoDB restore a dump
        bin/mongoexport       - Export a single collection to test (JSON, CSV)
        bin/mongoimport       - Import from JSON or CSV
        bin/mongofiles        - Utility for putting and getting files from MongoDB GridFS
        bin/mongostat         - Show performance statistics

3. 使用
    
        mkdir /data/db
        ./mongod
        ./mongo
        mongodb://admin:123456@localhost  //以admin身份，密码123456连接到本地mongo
        use test   //切换到test数据库，不存在则自动创建
        show dbs  //看不到test，需插入数据
        db.test.insert({'name':'wuruimiao'})

        db.dropDatabase()  //删除test
        db.collection.drop() //删除集合

        use test
        db.collection.insert({'name':'wuruimiao'}) //插入文档
        db.collection.save({'name':'wuruimiao'})
        db.collection.find() //查看已插入文档
        db.collection.find().pretty()

        db.collection.insert({'name':'wuruimiao', 'year':22})
        db.collection.update({'name':'wuruimiao'}, {$set:{'year':18}}) //更新文档
        db.collection.update({'name':'wuruimiao'}, {$set:{'year':18}}, {multi:true}) //更新所有符合条件的文档
        //update的其他参数
        //upsert: 默认false，不存在记录时不插入记录，
        //multi: 默认false，只更新第一条符合条件的记录，true更新所有符合条件的
        //writeConcern: 抛出异常的级别
        db.collecion.save({"_id":ObjectId("150212310")}) //指定_id以更新

        db.collection.remove({'name':'wuruimiao'}) //删除所有符合条件的数据
        db.collection.remove({'name':'wuruimiao'}, ) //删除所有符合条件的数据
        db.collection.remove({}) //删除所有符合条件的数据

        //查询
        









##mongoengine

###简单使用
1. models.py
        
        from mongoengine import *
        class Course(Document):
            _id = ObjectIdField(required=True, primary_key=True)                             
            course_id = StringField(required=True, db_field='id')                            
            name = StringField(required=True)                                                
            status = IntField(required=True, default=0)                                      
            begin_day = DateTimeField(required=True, db_field='beginDay')                    
            end_day = DateTimeField(required=True, db_field='endDay')                        
            subject = IntField(required=False)                                               
            grade = IntField(required=True)                                                  
            type = IntField(required=True, default=0)                                        
            teachers = ListField(StringField())                                              
            students = ListField(StringField())                                              
            lessons = ListField(StringField())                                               
            insert_time = DateTimeField(required=True, db_field='insertTime')                
            v = IntField(required=False, db_field='__v')                                     
            meta = {                                                                         
                'collection': 'courses'                                                      
            }

2. views.py
    
        from models import *
        from mongoengine import connect
        connect('nc-server', host='mongodb://user:passwd@address')
        data = Course.objects().as_pymongo()


###Nodejs和Mongodb
####基本概念
Schema  ：一种以文件形式存储的数据库模型骨架，不具备数据库的操作能力
Model   ：由Schema发布生成的模型，具有抽象属性和行为的数据库操作对
Entity  ：由Model创建的实体，他的操作也会影响数据库
####
1. 在项目中只能创建一个数据库连接
    
        var mongoose = require('mongoose');
        var db = mongoose.createConnection('localhost', 'test');

